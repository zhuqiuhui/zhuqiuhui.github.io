<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  
  <title>桃子的博客铭</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="淡泊明志，宁静致远！">
<meta property="og:type" content="website">
<meta property="og:title" content="桃子的博客铭">
<meta property="og:url" content="https://taozj.org/page/2/index.html">
<meta property="og:site_name" content="桃子的博客铭">
<meta property="og:description" content="淡泊明志，宁静致远！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="桃子的博客铭">
<meta name="twitter:description" content="淡泊明志，宁静致远！">
  
    <link rel="alternative" href="/atom.xml" title="桃子的博客铭" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
      <link href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" rel="stylesheet">
  
  
      <link href="//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css" rel="stylesheet">
  
  
      <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
  
      <style> .article { opacity: 0;} </style>
  
  <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/iconfont.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
  
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/clipboard.js/1.5.9/clipboard.min.js"></script>
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: true,
          fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
          scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.0.9/scrollreveal.min.js"
      }
  </script>

  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  

  
  
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/post_images/resources/avatar.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">taozj</a></h1>
        </hgroup>

        
        <p class="header-subtitle">高性能、高可用服务端开发</p>
        
        <br>
        
        <p class="header-subtitle">淡泊明志，宁静致远！</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives">文章归档</a></li>
                        
                            <li><a href="https://album.taozj.org">个人相册</a></li>
                        
                            <li><a href="https://wiki.taozj.org/doku.php">个人WiKi</a></li>
                        
                            <li><a href="/about">请你读我</a></li>
                        
                            <li><a href="/search.html">搜索本站</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/taozhijiang" title="GitHub"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/u/1683951363" title="新浪微博"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Email" target="_blank" href="mailto:dEB0YW96ai5vcmcK (base64)" title="Email"></a>
                            
                                <a class="fa QQ" target="_blank" href="/347714173" title="QQ"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/taozhijiang" title="Twitter"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-与Boost/">C++与Boost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux开发/">Linux开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/互联网/">互联网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内核/">内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/协议/">协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作/">工作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作相关/">工作相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发/">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发基础/">开发基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数学/">数学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构和算法/">数据结构和算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务运维/">服务运维</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/构架/">构架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活杂感/">生活杂感</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件/">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/运维/">运维</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/造轮子/">造轮子</a></li></ul>
                    </div>
                </section>
                
                
                

                
            </div>
        </div>
    </header>                
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">taozj</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/post_images/resources/avatar.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">taozj</a></h1>
            </hgroup>
            
            <p class="header-subtitle">高性能、高可用服务端开发</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives">文章归档</a></li>
                
                    <li><a href="https://album.taozj.org">个人相册</a></li>
                
                    <li><a href="https://wiki.taozj.org/doku.php">个人WiKi</a></li>
                
                    <li><a href="/about">请你读我</a></li>
                
                    <li><a href="/search.html">搜索本站</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/taozhijiang" title="GitHub"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/u/1683951363" title="新浪微博"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Email" target="_blank" href="mailto:dEB0YW96ai5vcmcK (base64)" title="Email"></a>
                            
                                <a class="fa QQ" target="_blank" href="/347714173" title="QQ"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/taozhijiang" title="Twitter"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-https-principle" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201701/https-principle.html" class="article-date">
      <time datetime="2017-01-17T16:39:59.000Z" itemprop="datePublished">2017-01-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201701/https-principle.html">HTTPS原理简单介绍</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　HTTPS在今后的互联网中必将扮演者越来越重要的角色了，国外互联网大佬对https部署也是竭力鼓吹呐喊，HTTP/2协议的推广更是逼着你不上也得上！在HTTPS普及化过程中，必然会损害某些集团的利益，但是这是互联网的趋势，历史的洪流是谁也阻挡不了的！<br>　　这篇文章就是对HTTPS的大概做一个了解，力图宏观上掌握其基本原理和流程，而其中涉及到的具体加密算法的细节之流就留给那些博士title的人研究去吧！<br>　　还是一样，要用Wireshark抓取和分析SSL/TLS的数据包，需要设置电脑的SSLKEYLOGFILE环境变量才可以。在Windows上面搞了好久，发现抓到的数据包还是不能解密，最后在Ubuntu下一次就完成了，看来搞开发的话还要Linux算是神器啊！抓取的数据包和Master-Secret也打包<a href="/upload/taozj.ssl.pcapng.zip">共享</a>给大家了。此外为了简单起见，客户端请求禁用了Diffie Hellman支持，这个算法是为了提高安全性考虑的，好处就是密钥可以独立于服务器的私钥，所以历史数据即使在私钥被窃取的情况下，会话的内容也无法被破解。<br><img src="/post_images/images/201701/538d95ba.png" alt="https"><br>　　上面展现的客户端和服务器整个通信过程尽收眼底：首先三次握手建立TCP连接，然后客户端发起HTTP请求并得到302跳转，客户端进行ACK确认后，转而向443端口进行TCP三次握手连接，接下来就是TLS协商，加密信道建立后采用加密方式进行数据的传输。流程中夹杂着TLS和TCP的数据包，这一点也不奇怪，因为ACK是TCP协议的特性哦！<br>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/开发进阶/">开发进阶</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/互联网/">互联网</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/协议/">协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201701/https-principle.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-rpc-principle-and-tips" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201701/rpc-principle-and-tips.html" class="article-date">
      <time datetime="2017-01-15T04:33:03.000Z" itemprop="datePublished">2017-01-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201701/rpc-principle-and-tips.html">RPC设计和使用中的一些杂谈</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　RPC当前在大公司的开发中越来越流行了，各大厂的开源RPC框架也呈百花开放的状态。在通过前面的<a href="/201612/learn-note-of-google-grpc.html">文章</a>做了一个对Google出品之gRPC的使用手册，也算是在使用方面有了一个基本的了解。恰巧最近逛别人博客的时候，看到几篇关于RPC原理和设计方面的文章，觉得十分不错，于是这里就将这些文章进行整理，对RPC设计、使用和实现中的那些乱七八糟的问题进行一个归纳总结。</p>
<h1 id="一、RPC的原理和关键点">一、RPC的原理和关键点</h1><h2 id="1-1_RPC的原理">1.1 RPC的原理</h2><p><img src="/post_images/images/201701/796a12cc.png" alt="rpc"><br>　　RPC的原理可以说是再简单不过了，一张图足以说明问题，总体来说会经历以下的步骤：<br>　　(1). client代码像普通函数调用一样调用client stub函数，这个调用是本地调用，调用参数会和平常函数调用一样进行返回地址和调用参数压栈操作；<br>　　(2). client stub会把调用参数和其它信息(比如调用方法名、调用属性等，可以称为metadata)进行打包封装成message，然后通过系统调用发送该message，这个打包的过程是个序列化的过程；<br>　　(3). client寻求到服务端的地址，然后通过本地操作系统经由某种协议，将上述message发送给server端；<br>　　(4). server端的操作系统接收message后将其传递给server stub；
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-与Boost/">C++与Boost</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/互联网/">互联网</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201701/rpc-principle-and-tips.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-learn-note-of-distributed-system-(6)-application" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201701/learn-note-of-distributed-system-(6)-application.html" class="article-date">
      <time datetime="2017-01-14T04:16:15.000Z" itemprop="datePublished">2017-01-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201701/learn-note-of-distributed-system-(6)-application.html">分布式系统入门笔记（六）：基于ZooKeeper的分布式系统的应用场景</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　至此，Paxos、Raft、ZAB代表着分布式系统中最常见的一致性协议都有所了解，但是除了PaxSql之外，对于分布式系统一致性原理的实际应用还处于一脸懵逼的状态中。此处于是主要借着<a href="https://book.douban.com/subject/26292004/">《从Paxos到Zookeeper:分布式一致性原理与实践》</a>中的案例，依靠ZooKeeper分布式系统组建，对分布式系统的使用情境做一个简单的了解。毕竟嘛，我又不是做学术的，了解原理后不知道现实有什么用处又有啥意义…<br>　　ZooKeeper扮演者分布式系统的管理和协调框架的作用，通过前面对ZAB和ZooKeeper的了解，ZooKeeper通过ZNode数据模型和序列号、持久和临时节点分类，以及Watcher事件通知机制，可以快速构建分布式应用的核心功能，看看Apache旗下那么多基于ZooKeeper的分布式项目就可晓而知了。ZooKeeper的集群达到3台就可以正常工作了，但是工业上通常认为至少达到5台才是合适的，一方面机器增多集群的可靠性增加了，再次集群工作过程中常常会有机器下线维护的情况，这样在一台机器下线的时候集群还可以容易一台机器宕机而不停止服务。<br><img src="/post_images/images/201701/3ac72ee6.jpg" alt="zookeeper"><br>　　再次说明，个人没什么分布式系统的经验，这些都是查阅资料摘抄得来，如果错误尽请指正，被我误导概不负责！</p>
<p><strong>一、数据发布/订阅(配置中心)</strong> - Publish/Subscribe<br>　　发布/订阅模式不仅仅会出现在这里，通常消息队列的设计中会更加常用到这种模式。发布/订阅模式功能可以分为这几种模式：<br>　　(1). Push模式是服务器主动将数据更新发送给所有订阅的客户端，优点是实时性好，但是服务端的工作比较繁重，常常需要记录各个客户端的状态信息，甚至要考虑消费者的消费能力实现流量控制工作；<br>　　(2). Pull模式则是由客户端主动发起请求来获取最新数据，通常采用定时机制轮训拉取的方式进行，所以实时性较差，但好处是实现简单；<br>　　(3). 还有就是结合两者进行推拉相结合的方式，客户端向服务端注册自己关心的主题，一旦主题数据有所更新，服务端会向对应订阅的客户端发送事件通知，客户端接收到事件通知后主动向服务器拉取最新的数据。
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/互联网/">互联网</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201701/learn-note-of-distributed-system-(6)-application.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-learn-note-of-distributed-system-(5)-zab-consensus" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201701/learn-note-of-distributed-system-(5)-zab-consensus.html" class="article-date">
      <time datetime="2017-01-13T14:25:15.000Z" itemprop="datePublished">2017-01-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201701/learn-note-of-distributed-system-(5)-zab-consensus.html">分布式系统入门笔记（五）：ZooKeeper之ZAB一致性协议</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　得益于Zookeeper在生产环境的广为使用，ZAB(ZooKeeper Atomic Broadcast，ZooKeeper原子消息广播协议)可算是最广泛应用的分布式一致性协议了，其是对Paxos算法进行了大量的改进后形成的分布式系统数据一致性协议。当之前了解Paxos和Raft算法后，落下ZAB总觉得欠缺了那么点什么。查看资料发现ZooKeeper是2007年开始开发的，而Raft算法2013年才正式发布，所以Raft中的一些设计难免会借鉴ZAB，两者存在了很多相似之处，不过多了解多掌握，想必对于分布式系统原理的融汇贯通还是会大有裨益的！</p>
<h1 id="一、前言">一、前言</h1><p>　　首先强调一点，无论是ZAB还是Raft，作为生产环境都极度强调了事务严格按照客户端请求的顺序提交，这一点在<a href="https://cwiki.apache.org/confluence/display/ZooKeeper/Zab+vs.+Paxos">Zab+vs.+Paxos</a>中解释的很清楚：<br>　　Paxos注重的是一个状态机模型，一致性协议保证所有的状态机副本以相同的顺序执行相同的指令，那么所有状态机可以保证以相同的状态变化进行转移。而为了性能方面的考虑，一致性算法都允许客户端提出多个提议，当客户端并行或者重叠地提出多个决议的情况。在MultiPaxos就有了提交窗口的概念，但是在某个时刻点Leader发生崩溃后，对应的提交窗口中的提案可能有的提案被提交，有提案未被提交，那么新选出来的Leader可以按照任何顺序重新组织这些提案的表决和提交顺序，甚至也有可能会被丢弃掉。所以，Paxos算法没能够保证严格的因果一致性。<br>　　ZAB和Raft注重的是主备(primary-backup)工作模式，各个副本节点会严格按照Leader接收到客户端请求的顺序进行提交，所以可以描述为一种可靠的增量状态更新。客户端可以提出多个决议，这些决议保证会按照FIFO的顺序被提交，即便在Leader崩溃后发生Leader选取的情况下也会有此保证。虽然，Paxos可以不开启提交窗口的功能，任何时候都只允许有一个未提交的决议，那么就可以得到严格序列化的状态转移，但是相比ZAB和Raft这种专门设计优化过的一致性协议，性能会大打折扣；还有就是Paxos算法可以通过将多个提案封包成batch模式，然后整体显露作为一个提案来表决处理(PhxPaxos有这么一个特性)以提高性能，但是按照Paper所述这些改进措施不见得性能会有多大的提高。<br>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/互联网/">互联网</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201701/learn-note-of-distributed-system-(5)-zab-consensus.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-linux-performance-basic" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201701/linux-performance-basic.html" class="article-date">
      <time datetime="2017-01-03T15:24:43.000Z" itemprop="datePublished">2017-01-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201701/linux-performance-basic.html">Linux服务器的那些性能参数指标</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　一个基于Linux操作系统的服务器运行的同时，也会表征出各种各样参数信息。通常来说运维人员、系统管理员会对这些数据会极为敏感，但是这些参数对于开发者来说也十分重要，尤其当你的程序非正常工作的时候，这些蛛丝马迹往往会帮助快速定位跟踪问题。<br>　　这里只是一些简单的工具查看系统的相关参数，当然很多工具也是通过分析加工/proc、/sys下的数据来工作的，而那些更加细致、专业的性能监测和调优，可能还需要更加专业的工具(perf、systemtap等)和技术才能完成哦。毕竟来说，系统性能监控本身就是个大学问。<br><img src="/post_images/images/201701/76667dfc.png" alt="linux-performance"></p>
<h1 id="一、CPU和内存类">一、CPU和内存类</h1><h2 id="1-1_top">1.1 top</h2><p>　　<code bash>➜  ~ top</code><br><img src="/post_images/images/201701/bbbd0eb3.png" alt="linux-top"><br>　　第一行后面的三个值是系统在之前1、5、15的平均负载，也可以看出系统负载是上升、平稳、下降的趋势，当这个值超过CPU可执行单元的数目，则表示CPU的性能已经饱和成为瓶颈了。</p>
<p>　　第二行统计了系统的任务状态信息。running很自然不必多说，包括正在CPU上运行的和将要被调度运行的；sleeping通常是等待事件(比如IO操作)完成的任务，细分可以包括interruptible和uninterruptible的类型；stopped是一些被暂停的任务，通常发送SIGSTOP或者对一个前台任务操作Ctrl-Z可以将其暂停；zombie僵尸任务，虽然进程终止资源会被自动回收，但是含有退出任务的task descriptor需要父进程访问后才能释放，这种进程显示为defunct状态，无论是因为父进程提前退出还是未wait调用，出现这种进程都应该格外注意程序是否设计有误。<br>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/运维/">运维</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/内核/">内核</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开发基础/">开发基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服务运维/">服务运维</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件/">软件</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201701/linux-performance-basic.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-cmd-tools-sed-awk" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201612/cmd-tools-sed-awk.html" class="article-date">
      <time datetime="2016-12-28T14:34:39.000Z" itemprop="datePublished">2016-12-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201612/cmd-tools-sed-awk.html">文本处理利器sed与awk使用总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　 在整理为知笔记的时候，发现很久以前写的awk、sed学习笔记，这不禁然让我回想起自己最开始接触Linux的情形。那时候还在江安校区东五宿舍，一天晚上打开水瞄到了一张海报——“你想了解让微软感到畏惧的操作系统么？”虽然这个讲座最后我也没听成，但也自从那时起Linux就在我心中烙下了深深的印记。上学的时候家里真的很穷，学费也是申请的助学贷款，自认自己从小开始还是比较懂事的，也不知道那时什么勇气让我跟父母开口要四千多块钱买电脑的，但父母还是爽快地支持了我，放假前入手了当时乞丐版ThinkPad R60e，这台电脑用的Celeron处理器(后面手动升级成了Core Solo单核处理器)，1024x768的LCD显示器，80G的硬盘居然也装了双系统，虽然烂但是陪我度过了好几个年头，直到我研究生实习后用自己的实习工资换了另外一台联想笔记本(现在还在给我老婆用)它才下岗，当然这已是后话了！<br>　　 做的这个笔记，是在放暑假前从图书馆借的那本蓝皮《Unix Shells by Example》，暑假过程中自己折腾的产物，其实当时根本不知道学习这个有什么用。sed、awk当然不会用来单独开发程序，但是在命令行处中理文本，字段切割，分析日志，写一些shell脚本(比如数据库patch)的时候，还有就是在自动化做软件、服务配置文件更新的时候，还是非常好用的。</p>
<h1 id="一、sed_-_stream_editor_for_filtering_and_transforming_text">一、sed - stream editor for filtering and transforming text</h1><p>　　 <strong>sed的操作格式</strong></p>
<blockquote>
<p>➜  ~ sed -opts ‘command’ filename(s)<br>➜  ~ … | sed -opts ‘command’  # 管道输入</p>
</blockquote>
<p>　　 <strong>sed的opts选项</strong></p>
<blockquote>
<p>-n 取消默认打印。默认情况下会全文打印，因此会重复打印匹配的记录，而这个选项用来只打印匹配记录<br>-e 多个command可以用这个连接，比如 sed -n -e ‘cmd1’ -e ‘cmd2’ files<br>-i 使sed的编辑保存。默认sed操作没有破坏性(不会对原文件修改)，但是确实要编辑原文件时候可以加上该参数</p>
</blockquote>
<p>　　 这里实验使用《UNIX shell by example》里面的datafile文件作为数据集。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> ➜  ~ cat datafile</div><div class="line">northwest       NW      Charles Main            3.0     .98     3       34</div><div class="line">western         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">southern        SO      Suan Chin               5.1     .95     4       15</div><div class="line">southeast       SE      Patricia Hemenway       4.0     .7      4       17</div><div class="line">eastern         EA      TB Savage               4.4     .84     5       20</div><div class="line">northeast       NE      AM Main Jr.             5.1     .94     3       13</div><div class="line">north           NO      Margot Weber            4.5     .89     5        9</div><div class="line">central         CT      Ann Stephens            5.7     .94     5       13</div><div class="line"> ➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="1-1_删除_d">1.1 删除 d</h2><p>注意，和通常的法则不一样，下面的行号都是从1开始计数的。<br>(a) <code> ➜  ~ sed ‘3d’ datafile</code><br>删除第3行，其余行打印到屏幕上。再次强调sed默认没有破坏性，原文件datafile没有改变。<br>(b) <code> ➜  ~ sed ‘3,$d’ datafile</code><br>删除第3行到文件的末尾记录，只打印剩余的第1,2两行。$代表文件或者记录的最后一行<br>(c) <code> ➜  ~ sed ‘$d’ datafile </code><br>删除最后一行。<br>(d) <code> ➜  ~ sed ‘/north/d’ datafile</code><br>删除匹配north的行，其余记录都被打印。<br>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/开发基础/">开发基础</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开发基础/">开发基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服务运维/">服务运维</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件/">软件</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201612/cmd-tools-sed-awk.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-install-gentoo-root-zfs-on-macbookpro-2015-early" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201612/install-gentoo-root-zfs-on-macbookpro-2015-early.html" class="article-date">
      <time datetime="2016-12-25T04:55:00.000Z" itemprop="datePublished">2016-12-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201612/install-gentoo-root-zfs-on-macbookpro-2015-early.html">MacbookPro上基于ZFS的Gentoo双系统安装</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　实在没想到，买了Macbook Pro还是避免不了折腾的命，原本很大程度买Macbook Pro就是不想折腾滴。<br>　　或许上层开发程序员无所谓，但无奈对于对做Linux底层开发者来说，涉及到macOS和Linux操作系统的差异性太大了；即使macOS命令行程序无比丰富，但是BSD风格和Linux那一套相比有时候差异还挺大的；8G内存用虚拟机太吃力了——总之，这种情况唯有双系统可解～<br>　　至于发行版，自从遇到Gentoo之后，就对其他发行版无爱了，而文件系统也一直坚持着ZFS装系统，XFS保存数据。这次是macOS+Gentoo了，原理和步骤差异不大，这里总结一下，给需要的人做个参考吧！<br><img src="/post_images/images/201612/11bbad51.jpg" alt="gentoo"></p>
<ol>
<li><strong>EFI启动引导rEFInd</strong><br>　　因为macOS系统使用GPT分区和EFI引导模式，所以要安装的Gentoo也必须使用这种引导模式。rEFInd是一个优秀的EFI引导器，支持Windows/macOS/Linux平台，所以这里需要使用rEFInd来接管，然后用来引导macOS和Gentoo。<br>　　安装rEFInd的方式十分简单，按照<a href="http://www.rodsbooks.com/refind/sip.html">教程</a>几步就可以了。从EI Capitan开始，macOS启用了SIP特性，所以必须在恢复模式下安装rEFInd。
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/生活/">生活</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/工作相关/">工作相关</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开发基础/">开发基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服务运维/">服务运维</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件/">软件</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201612/install-gentoo-root-zfs-on-macbookpro-2015-early.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-learn-note-of-distributed-system-(4)-raft-consensus" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201612/learn-note-of-distributed-system-(4)-raft-consensus.html" class="article-date">
      <time datetime="2016-12-19T12:46:55.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201612/learn-note-of-distributed-system-(4)-raft-consensus.html">分布式系统入门笔记（四）：Raft一致性算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="一、前言">一、前言</h1><p>　　Paxos在分布式系统中地位是不容置疑的，现代分布式系统的实现基本都直接或者间接依赖于Paxos算法。不过Paxos算法有着固有的缺陷：原始的BasicPaxos原理还是比较容易理解的，整个算法无非被分为Prepare和Accept两个阶段，但是要把这种算法工程化实现，各个节点的角色是对等的，系统的效率(可用性)将会非常的低，所以常用的也就是MultiPaxos变体版本以提高性能，这也就隐含的包含了leader的概念了，然后MultiPaxos还允许一个提交窗口，窗口中允许发起多个提案，但是这种情况下考虑到服务器随时可能崩溃的情况，算法将会变得极端复杂。Lamport爷爷就此也是简明说了几句不清不楚的优化，没有具体的实现细节，算是挖了一个巨坑吧。所以说了解BasicPaxos只是一个皮毛，将其推送到工程化可不是件容易的事情。<br>　　Raft算法是斯坦福两位博士生提出的分布式一致性系统，从其论文的题目《<a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm</a>》可以看出，作者以Paxos过于复杂为出发点，力求得到一个正常智商的大学生都能看懂，且工程上也容易实现的分布式系统一致性算法为目标。Raft算法借鉴了Paxos的原理，但最大不同是显式强化了Leader这个角色(虽然很多Paxos算法的实现也会产生Leader角色，但这不是Paxos算法本身所必须的)，并添加了各种约束条件(比如日志的连续性)，让算法更加容易理解和实现。虽然吾等草根屁民尚且不能从理论上审视这个算法的正确性，不过短短时间内美国很多著名大学分布式教学都将Raft算法列入教学课程，且基于Raft协议的项目也越来越多，这些事实已经足以证明一切了。<br>　　学习Raft算法，一篇<a href="https://raft.github.io/raft.pdf">普通论文</a>和一篇<a href="https://ramcloud.stanford.edu/~ongaro/thesis.pdf">博士学位论文</a>算是不得不读的经典，而前者网上发现了翻译好的中文版本，简单对比了一下原文，发现翻译的质量还是挺高的，很值得参考，但有些原理中文理解困难的话可以对比英文方便理解。作为正规论文，按照论文八股需求难免有些啰嗦拖沓，本文就是按照前面论文阅读摘抄一些重点要点出来，而后面那篇两百多页的博士论文，后面可以慢慢评鉴一下作为补充吧，当然最好的方式还是——一言不合就读<a href="https://github.com/logcabin/liblogcabin">代码</a>，毕竟作者说就两千多行！<br>　　还有，论文对状态机的描述比较的好，算是归纳了分布式系统的本质——复制状态机的基础是通过复制日志来实现的：当每个副本的初始状态相同，只要保证各个副本得到的日志都是顺序且一致的，那么按照相同的顺序执行这些日志中的指令，所有副本必然可以进行相同的状态转移得到相同的结果。所以分布式系统解决的根本问题，就是一致性问题，具体就是日志一致性问题，在这个基础上，上层就可以方便实现分布式日志、分布式数据库(bin log)、分布式存储等具体业务了。<br><img src="/post_images/images/201612/b0c484d0.jpg" alt="raft-stat"></p>
<h1 id="二、Raft算法">二、Raft算法</h1><h2 id="2-1_Raft算法基础">2.1 Raft算法基础</h2><p>　　Raft算法保证和Paxos算法具有相同的安全性，当集群中绝大多数服务器是正常的，则集群即可以正常工作，比如5个节点的集群，允许2个节点的失效。Raft算共有三种角色、需要处理三个问题，三个角色分别是Leader、Candidate、Follower，三个问题是Leader选举、日志复制和安全性，三个问题将会在后面详细阐述。<br>　　任何服务器只能处于上述三种角色中的一种，正常工作的集群具有一个Leader，剩余的节点都是Fellower，系统保证任何时候至多只有一个Leader，也有可能在选举的过程中尚未产生Leader，而在选举新Leader的时候会产生Candidate这个角色。<br>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/互联网/">互联网</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201612/learn-note-of-distributed-system-(4)-raft-consensus.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-read-note-of-amazon-dynamo" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201612/read-note-of-amazon-dynamo.html" class="article-date">
      <time datetime="2016-12-16T14:15:34.000Z" itemprop="datePublished">2016-12-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201612/read-note-of-amazon-dynamo.html">Amazon Dynamo论文阅读笔记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　其实个人一直比较喜欢读Google、Amazon、Facebook这类科技公司工程化的paper，一方面是这类文章通常不会夹杂着让人看着眼花缭乱的数学公式(而且很多文章往往很简单的道理也会被装饰的神神叨叨滴)；二来这些系统用到的技术都比较的大众成熟，可以很容易的在网上搜到相关资料，让你在短短时间就知道大概是个什么意思；还有最主要的是这些论文是进行实实在在工程化并用于生产环境了，方案可行性自然不用多说，在实现的过程中遇到的各种现实、细节问题也是很值得学习揣摩和借鉴的。比如，接下来要说的<a href="http://s3.amazonaws.com/AllThingsDistributed/sosp/amazon-dynamo-sosp2007.pdf">《Dynamo: Amazon’s Highly Available Key-value Store》</a>这篇论文要算是分布式系统设计实现中的必读经典了，虽然该套系统没有开源，而且由于商业机密部分内容没能够详细阐述，但丝毫没有影响到它对分布式系统设计实现的重要指导作用。<br><img src="/post_images/images/201612/3a93058f.png" alt="aws"></p>
<h1 id="一、前言">一、前言</h1><p>　　Amazon Dynamo系统的设计和实现从最开始就比较的实用主义：首先Amazon作为全球最领先的电商企业，其丰富的经验让其可以洞悉到绝大多数互联网公司的需求点和关切点，其次Dynamo是作为服务出售的，所以其并没有设计实现成一个至臻完美的分布式存储模型，它只支持K-V非关系型键值存储，就像是一个巨大的dict/map结构，只支持get()、put()两种简单访问方式，优化成高可写入性要求，存储的对象尺寸大多小于1M，成本考虑上支持99.9%级别的可用性(百毫秒读写响应)，但依据Amazon在云计算领域的强大实力，该系统在性能、可靠性、效能、伸缩性等方面没有丝毫的妥协。<br>　　和绝大多数分布式系统一样，Dynamo使用最终一致性获取性能从而保证可用性的，然后通过现有各项成熟的技术手段解决项目中的各种问题：数据使用一致性hashing进行分区，同时提供数据副本保证安全；通过NWR和对象vector lock版本机制有限的解决冲突并实现最终一致性；Merkle tree数据结构可以实现节点间数据的高效同步；整个系统完全去中心化，采用Gossip协议实现成员变更的同步。</p>
<h1 id="二、背景知识">二、背景知识</h1><h2 id="2-1_系统假设和设计需求">2.1 系统假设和设计需求</h2><p>　　a. 访问模式：数据项通过key唯一确定，且只提供读、写两个操作接口，对象采用二进制方式存储。这种K-V的存储符合绝大多数互联网海量对象的存储需求，对象的读取写入只支持单个对象的操作，任何多对象、关系性的操作都不支持；<br>　　b. ACID：就是分布式系统中的原子性、一致性、隔离性和持久性，强一致性模型虽然实现简单，但是可用性的最大杀手，所以该系统只提供最终一致性保证；同时也不支持隔离性，只提供单个元素的更新操作。<br>　　c. 有效性：服务必须提供稳定可靠的延时和吞吐量，根据在性能、价格、可用性和持久化各个因素的考量和妥协中，提供99.9%的可访问性；<br>　　由于在内部使用，所以不用考虑授权、鉴权操作，整个假设在一个可信环境的内网中执行的，不考虑拜占庭通信模型。
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/开发进阶/">开发进阶</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/互联网/">互联网</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201612/read-note-of-amazon-dynamo.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
    <article id="post-consistent-hashing" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201612/consistent-hashing.html" class="article-date">
      <time datetime="2016-12-14T12:59:18.000Z" itemprop="datePublished">2016-12-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/201612/consistent-hashing.html">一致性hashing的原理解析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>　　一致性hash最常见的应用情形就是缓存，其实只要涉及到hash和多台主机请求路由的情况，都可能涉及到一致性hash问题。一致性hash主要是考虑到集群中节点挂掉或新增节点的时候，要对已有节点的影响降到最小，传统hash值取余方式肯定不能满足这个要求，交换节点位置影响还有限，但是新增节点、删除节点会让绝大多数的缓存失效，除了导致性能骤降外很有可能会压垮后台服务器。对于日常使用的情况，节点挂掉算是小概率事件，但是对于像Amazon Dynamo这种规模的分布式集群来说，节点挂掉是必然事件——甚至每天都会有集群中的主机或者硬盘出问题。<br>　　一致性hash的解决思路，就是对缓存的object和Node使用同一个hash函数(实际不需要完全一致，但至少保证产生的hash空间相同)，让他们映射到同一个hash空间中去，当然这很容易实现，因为大多数的hash函数都是返回uint32类型，其空间即为1~$2^{32}$-1。然后各个Node就将整个hash空间分割成多个interval空间，然后对于每个缓存对象object，都按照顺时针方向遇到的第一个Node负责缓存它。通过这种方法，在新增加Node和删除Node的时候，只会对顺时针方向遇到的第一个Node负责的空间造成影响，其余的空间都仍然有效。<br><img src="/post_images/images/201612/58d63a48.png" alt="c-hash-add-remove"><br>　　假设有Object A、Object B、Object C、Object D四个对象，以及Node A、Node B、Node C、Node D四个节点。根据上面的一致性hash原理，如果Node C挂掉了，那么Node C掌管的区域(包括Object C)都将会由Node D所接管；而如果增加节点Node X，那么原先Node C掌管的空间将会被分割，导致Node X之前的对象Object C由Node X所接管；针对节点之间交换顺序的情况，也可以预见也只有交换的那两个节点对应的区间会被影响。
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/架构/">架构</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/201612/consistent-hashing.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2017 taozj
            </div>
            <div class="footer-right">
                <a href="http://www.miitbeian.gov.cn/" target="_blank" rel="nofollow">
                    <img src="/post_images/icons/icp_min.png" alt="粤ICP备17002382号-1">粤ICP备17002382号-1
                </a>
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258402767'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/stat.php%3Fid%3D1258402767%26online%3D2' type='text/javascript'%3E%3C/script%3E"));
                </script>
                Powered by <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>, theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题">Yelee</a>  enhanced by Nicol <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
    </div>
</footer>

    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.1.22/require.min.js"></script>
<script src="/js/search.js"></script> 


    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 10;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>




    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

    <script src="//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js"></script>


   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</script>

  </div>
</body>
</html>