<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  
  <title>文本处理利器sed与awk使用总结 | 桃子的博客铭</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在整理为知笔记的时候，发现很久以前写的awk、sed学习笔记，这不禁然让我回想起自己最开始接触Linux的情形。那时候还在江安校区东五宿舍，一天晚上打开水瞄到了一张海报——“你想了解让微软感到畏惧的操作系统么？”虽然这个讲座最后我也没听成，但也自从那时起Linux就在我心中烙下了深深的印记。上学的时候家里真的很穷，学费也是申请的助学贷款，自认自己从小开始还是比较懂事的，也不知道那时什么勇气让">
<meta property="og:type" content="article">
<meta property="og:title" content="文本处理利器sed与awk使用总结">
<meta property="og:url" content="https://taozj.org/201612/cmd-tools-sed-awk.html">
<meta property="og:site_name" content="桃子的博客铭">
<meta property="og:description" content="在整理为知笔记的时候，发现很久以前写的awk、sed学习笔记，这不禁然让我回想起自己最开始接触Linux的情形。那时候还在江安校区东五宿舍，一天晚上打开水瞄到了一张海报——“你想了解让微软感到畏惧的操作系统么？”虽然这个讲座最后我也没听成，但也自从那时起Linux就在我心中烙下了深深的印记。上学的时候家里真的很穷，学费也是申请的助学贷款，自认自己从小开始还是比较懂事的，也不知道那时什么勇气让">
<meta property="og:updated_time" content="2016-12-30T08:57:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="文本处理利器sed与awk使用总结">
<meta name="twitter:description" content="在整理为知笔记的时候，发现很久以前写的awk、sed学习笔记，这不禁然让我回想起自己最开始接触Linux的情形。那时候还在江安校区东五宿舍，一天晚上打开水瞄到了一张海报——“你想了解让微软感到畏惧的操作系统么？”虽然这个讲座最后我也没听成，但也自从那时起Linux就在我心中烙下了深深的印记。上学的时候家里真的很穷，学费也是申请的助学贷款，自认自己从小开始还是比较懂事的，也不知道那时什么勇气让">
  
    <link rel="alternative" href="/atom.xml" title="桃子的博客铭" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
      <link href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" rel="stylesheet">
  
  
      <link href="//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css" rel="stylesheet">
  
  
      <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/iconfont.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
  
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/clipboard.js/1.5.9/clipboard.min.js"></script>
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: true,
          fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
          scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.0.9/scrollreveal.min.js"
      }
  </script>

  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  

  
  
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/post_images/resources/avatar.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">taozj</a></h1>
        </hgroup>

        
        <p class="header-subtitle">高性能、高可用服务端开发</p>
        
        <br>
        
        <p class="header-subtitle">淡泊明志，宁静致远！</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives">文章归档</a></li>
                        
                            <li><a href="https://album.taozj.org">个人相册</a></li>
                        
                            <li><a href="https://wiki.taozj.org/doku.php">个人WiKi</a></li>
                        
                            <li><a href="/about">请你读我</a></li>
                        
                            <li><a href="/search.html">搜索本站</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/taozhijiang" title="GitHub"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/u/1683951363" title="新浪微博"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Email" target="_blank" href="mailto:dEB0YW96ai5vcmcK (base64)" title="Email"></a>
                            
                                <a class="fa QQ" target="_blank" href="/347714173" title="QQ"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/taozhijiang" title="Twitter"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-与Boost/">C++与Boost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux开发/">Linux开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/互联网/">互联网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内核/">内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/协议/">协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后台开发/">后台开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作/">工作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作相关/">工作相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发/">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发基础/">开发基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数学/">数学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构和算法/">数据结构和算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务运维/">服务运维</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/构架/">构架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活杂感/">生活杂感</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件/">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/运维/">运维</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/造轮子/">造轮子</a></li></ul>
                    </div>
                </section>
                
                
                

                
            </div>
        </div>
    </header>                
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">taozj</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/post_images/resources/avatar.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">taozj</a></h1>
            </hgroup>
            
            <p class="header-subtitle">高性能、高可用服务端开发</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives">文章归档</a></li>
                
                    <li><a href="https://album.taozj.org">个人相册</a></li>
                
                    <li><a href="https://wiki.taozj.org/doku.php">个人WiKi</a></li>
                
                    <li><a href="/about">请你读我</a></li>
                
                    <li><a href="/search.html">搜索本站</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/taozhijiang" title="GitHub"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/u/1683951363" title="新浪微博"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Email" target="_blank" href="mailto:dEB0YW96ai5vcmcK (base64)" title="Email"></a>
                            
                                <a class="fa QQ" target="_blank" href="/347714173" title="QQ"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/taozhijiang" title="Twitter"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-cmd-tools-sed-awk" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/201612/cmd-tools-sed-awk.html" class="article-date">
      <time datetime="2016-12-28T14:34:39.000Z" itemprop="datePublished">2016-12-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      文本处理利器sed与awk使用总结
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/开发基础/">开发基础</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开发基础/">开发基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服务运维/">服务运维</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件/">软件</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>　　 在整理为知笔记的时候，发现很久以前写的awk、sed学习笔记，这不禁然让我回想起自己最开始接触Linux的情形。那时候还在江安校区东五宿舍，一天晚上打开水瞄到了一张海报——“你想了解让微软感到畏惧的操作系统么？”虽然这个讲座最后我也没听成，但也自从那时起Linux就在我心中烙下了深深的印记。上学的时候家里真的很穷，学费也是申请的助学贷款，自认自己从小开始还是比较懂事的，也不知道那时什么勇气让我跟父母开口要四千多块钱买电脑的，但父母还是爽快地支持了我，放假前入手了当时乞丐版ThinkPad R60e，这台电脑用的Celeron处理器(后面手动升级成了Core Solo单核处理器)，1024x768的LCD显示器，80G的硬盘居然也装了双系统，虽然烂但是陪我度过了好几个年头，直到我研究生实习后用自己的实习工资换了另外一台联想笔记本(现在还在给我老婆用)它才下岗，当然这已是后话了！<br>　　 做的这个笔记，是在放暑假前从图书馆借的那本蓝皮《Unix Shells by Example》，暑假过程中自己折腾的产物，其实当时根本不知道学习这个有什么用。sed、awk当然不会用来单独开发程序，但是在命令行处中理文本，字段切割，分析日志，写一些shell脚本(比如数据库patch)的时候，还有就是在自动化做软件、服务配置文件更新的时候，还是非常好用的。</p>
<h1 id="一、sed_-_stream_editor_for_filtering_and_transforming_text">一、sed - stream editor for filtering and transforming text</h1><p>　　 <strong>sed的操作格式</strong></p>
<blockquote>
<p>➜  ~ sed -opts ‘command’ filename(s)<br>➜  ~ … | sed -opts ‘command’  # 管道输入</p>
</blockquote>
<p>　　 <strong>sed的opts选项</strong></p>
<blockquote>
<p>-n 取消默认打印。默认情况下会全文打印，因此会重复打印匹配的记录，而这个选项用来只打印匹配记录<br>-e 多个command可以用这个连接，比如 sed -n -e ‘cmd1’ -e ‘cmd2’ files<br>-i 使sed的编辑保存。默认sed操作没有破坏性(不会对原文件修改)，但是确实要编辑原文件时候可以加上该参数</p>
</blockquote>
<p>　　 这里实验使用《UNIX shell by example》里面的datafile文件作为数据集。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> ➜  ~ cat datafile</div><div class="line">northwest       NW      Charles Main            3.0     .98     3       34</div><div class="line">western         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">southern        SO      Suan Chin               5.1     .95     4       15</div><div class="line">southeast       SE      Patricia Hemenway       4.0     .7      4       17</div><div class="line">eastern         EA      TB Savage               4.4     .84     5       20</div><div class="line">northeast       NE      AM Main Jr.             5.1     .94     3       13</div><div class="line">north           NO      Margot Weber            4.5     .89     5        9</div><div class="line">central         CT      Ann Stephens            5.7     .94     5       13</div><div class="line"> ➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="1-1_删除_d">1.1 删除 d</h2><p>注意，和通常的法则不一样，下面的行号都是从1开始计数的。<br>(a) <code> ➜  ~ sed ‘3d’ datafile</code><br>删除第3行，其余行打印到屏幕上。再次强调sed默认没有破坏性，原文件datafile没有改变。<br>(b) <code> ➜  ~ sed ‘3,$d’ datafile</code><br>删除第3行到文件的末尾记录，只打印剩余的第1,2两行。$代表文件或者记录的最后一行<br>(c) <code> ➜  ~ sed ‘$d’ datafile </code><br>删除最后一行。<br>(d) <code> ➜  ~ sed ‘/north/d’ datafile</code><br>删除匹配north的行，其余记录都被打印。<br> <a id="more"></a></p>
<h2 id="1-2_替换_s">1.2 替换 s</h2><p>标志g表示是对行内所有匹配记录都进行替换，否则只对行内首次出现的记录进行替换<br>(a) <code> ➜  ~ sed -n ‘s/^west/north/p’ datafile</code><br>替换所有west打头记录，这里用了-n选项和p命令，只打印替换的记录<br>(b) <code> ➜  ~ sed ‘s/[0-9][0-9]$/&amp;.5/‘ datafile</code><br>符号$表示行末尾，符号&amp;在替换中用于表示前面匹配的内容，上面表示行结尾为2位数的数字，添加.5成为xx.5。如果要用到&amp;的字面意思，需要使用\&amp;转意方可。<br><code>  ➜  ~ sed -n ‘s/[0-9][0-9]$/&amp;.5\&amp;/p’ datafile</code><br>(c) 标记符号()，可以复用前面的内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ sed -n <span class="string">'s/\(Mar\)go\(t\)/\1ianne\2/p'</span> datafile</div><div class="line">north           NO      Mariannet Weber            4.5     .89     5        9</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>这里\1复用了前面标记的Mar，而\2复用了t。<br>(d)　默认的替换分隔符是/，其实sed可以使用任何分隔符，就是紧跟着s的那个符号。使用自定义的符号对于操作日期、路径等特殊记录很有效<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  nginx <span class="built_in">pwd</span></div><div class="line">/home/v5kf/nginx</div><div class="line">➜  nginx <span class="built_in">pwd</span> | sed <span class="string">'s#v5kf/nginx#ztao#g'</span></div><div class="line">/home/ztao</div><div class="line">➜  nginx</div></pre></td></tr></table></figure></p>
<h2 id="1-3_行范围_,">1.3 行范围 ,</h2><p>行范围的表示是双闭合的，就是包含匹配开始的行、匹配结束的行，以及两者之间的所有行: 5,10  /Dick/,/Joe/  /north/,$<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ sed -n <span class="string">'/south/,/theast/s/$/**TTT**/p'</span> datafile</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18**TTT**</div><div class="line">southern        SO      Suan Chin               5.1     .95     4       15**TTT**</div><div class="line">southeast       SE      Patricia Hemenway       4.0     .7      4       17**TTT**</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>这里将从south匹配行，到第一个theast匹配行结束，将每条匹配记录的$结尾替换(实际追加)成<strong>TTT</strong>。如果出现south，但是没有出现theast，就默认匹配到文件结尾的地方</p>
<h2 id="1-4_多次编辑_-e">1.4 多次编辑 -e</h2><p><code> ➜  ~ sed -e ‘1,3d’ -e ‘s/north/NORTH/‘ datafile</code><br>多个-e其操作是依次进行的，所以顺序还是有讲究的，不同的顺序对最终的结果可能会有影响<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">➜  ~ sed -n <span class="_">-e</span> <span class="string">'s/thw/THW/p'</span> <span class="_">-e</span> <span class="string">'s/west/WEST/p'</span> datafile </div><div class="line">norTHWest       NW      Charles Main            3.0     .98     3       34</div><div class="line">WESTern         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">souTHWest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">➜  ~ sed -n <span class="_">-e</span> <span class="string">'s/west/WEST/p'</span> <span class="_">-e</span> <span class="string">'s/thw/THW/p'</span> datafile     </div><div class="line">northWEST       NW      Charles Main            3.0     .98     3       34</div><div class="line">WESTern         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">southWEST       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="1-5_文件操作">1.5 文件操作</h2><p>(a) 读文件 r<br>将一个文件的内容加到当前的位置上实际就是在所有匹配行的下面插入文件内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">➜  ~ <span class="built_in">echo</span> <span class="string">"---newfile info---"</span> &gt; newfile</div><div class="line">➜  ~ sed <span class="string">'/west/r newfile'</span> datafile    </div><div class="line">northwest       NW      Charles Main            3.0     .98     3       34</div><div class="line">---newfile info---</div><div class="line">western         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">---newfile info---</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">---newfile info---</div><div class="line">southern        SO      Suan Chin               5.1     .95     4       15</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>(b) 写文件 w<br>把所有匹配到的记录都写入到指定的文件当中<br><code> ➜  ~ sed ‘/south/w newfile1’ datafile</code><br>(c) 追加文本 a<br>该命令是在匹配的记录后面直接追加提供的文本内容，感觉追加的内容有strip的效果，开始的空字符会被删除<br><code> ➜  ~ sed ‘/south/a    This is the message’ datafile</code><br>(d) 插入文本 i<br>跟上面的a命令类似，只不过这个i是插在匹配记录的前面<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  ~ sed <span class="string">'/western/i   - This is the message'</span> datafile</div><div class="line">northwest       NW      Charles Main            3.0     .98     3       34</div><div class="line">- This is the message</div><div class="line">western         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>(e) 替换文本 c<br>用该字符替换匹配到的整个记录行<br><code> ➜  ~ sed ‘/north/c This is the message’ datafile </code><br>(f) 下一行 n<br>对匹配到的记录，对其下一行做某些相应的操作<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ sed <span class="string">'/northwest/&#123;n; s/^\&lt;[a-z]*/XXTTZZF/; &#125;'</span> datafile </div><div class="line">northwest       NW      Charles Main            3.0     .98     3       34</div><div class="line">XXTTZZF         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>(g) 替换、转换操作 y<br>下面对第1,2两行记录中的字符做大写化转换<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ sed <span class="string">'1,2y/abcdefghigklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'</span> datafile</div><div class="line">NORTHWEST       NW      CHARLES MAIN            3.0     .98     3       34</div><div class="line">WESTERN         WE      SHARON GRAY             5.3     .97     5       23</div><div class="line">southwest       SW      Lewis Dalsass           2.7     .8      2       18</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>(h) 退出<br>直接退出，不做接下来记录的继续处理<br><code> ➜  ~ sed ‘5q’ datafile </code><br><code> ➜  ~ sed ‘/north/{ s/north/NORTH/; q; }’ datafile </code></p>
<h2 id="1-6_sed正则表达式的元字符">1.6 sed正则表达式的元字符</h2><p>Linux平台下很多工具(sed、awk、bash、python…)，其正则表达式虽然在大体上约定类似，但是很多细节方面的东西还是有所差异，使用不确定最好事先查询一下！<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">^         行首定位符</div><div class="line">$         行尾定位符</div><div class="line">.         匹配除换行之外的单个字符</div><div class="line">*         匹配0个或者多个前导字符(这里是前导字符0或者多个，任意一个或多个字符，使用 .* )</div><div class="line">[]        指定字符中的任意一个字符，比如[Ll] [a-z]</div><div class="line">[^]       上面一样，不匹配的字符</div><div class="line">\(..\)    保存匹配的字符，后面使用\1 \2..来引用，最多使用9个标签</div><div class="line">&amp;         保存查找匹配到的串，可以用在后面的替换中 s/love/**&amp;**/</div><div class="line">\&lt;        词首定位符，单词的开头</div><div class="line">\&gt;        词尾定位符</div><div class="line">x\&#123;m\&#125;    连续m个</div><div class="line">x\&#123;m,\&#125;   至少m个</div><div class="line">x\&#123;m,n\&#125;  m-n个,sed -n <span class="string">'s/[0-9]\&#123;2\&#125;$/&amp;.5/p'</span> datafile</div></pre></td></tr></table></figure></p>
<h1 id="二、awk_-_pattern_scanning_and_text_processing_language">二、awk - pattern scanning and text processing language</h1><p>注意，下面的操作都是针对gawk的。刚开始发现下面有些例程走不通，原来是Ubuntu上面默认装的个mawk，换成gawk就正常了，话说这个awk就那三个人发明的么，居然还有版本差异？<br>awk比上面的sed要复杂的多，支持运算符、逻辑判断、循环等基本操作，难怪在解释上面已经定位为一个language了。<br><strong>awk的操作格式</strong></p>
<blockquote>
<p>➜  ~ awk -opts ‘cmd’ filenames<br>➜  ~ … | awk -opts ‘cmd’  # 管道输入</p>
</blockquote>
<p>下面的实验操作默认使用《UNIX shell by example》里面的employees文件，也有很多是沿用上面的datafile。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> ➜  ~ cat employees</div><div class="line">Tom Jones       4424      5/12/66     543354</div><div class="line">Mary Adams      5346      11/4/63     28765</div><div class="line">Sally Chang     1654      7/22/54     650000</div><div class="line">Billy Black     1683      9/23/44     336500</div><div class="line"> ➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-1_简介">2.1 简介</h2><p>awk将输入的每行作为一条记录，默认的行分隔符就是换行符。$0指代每行的整条记录，而NR将每条记录所对应的行号保存在其中。<br><code> ➜  ~ awk ‘{print NR,$0}’ employees </code><br>每条记录都是由多个字段组成的，这些字段的分隔符默认是空白字符(空格或者制表符，如果想要改变这个默认设置，可以使用-F这个参数)，每条字段都是用$1,$2…开始标号表示，而每行的字段个数保存在NF这个特殊的字段当中。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk -F: <span class="string">'&#123;print NR, $1,$7&#125;'</span> /etc/passwd </div><div class="line">1 root /bin/bash</div><div class="line">2 daemon /usr/sbin/nologin</div><div class="line">3 bin /usr/sbin/nologin</div><div class="line">...</div></pre></td></tr></table></figure></p>
<h2 id="2-2_模式和操作">2.2 模式和操作</h2><p>awk的行为可以是花括号包起来的多个操作：<br><code>{action1; action2; … ;}</code><br>默认的模式匹配中就已经包含了if的意思了，表明当该模式满足时候就进行操作，如果没指定默认操作就是打印出这些满足要求的整行记录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'/Tom/'</span> employees</div><div class="line">Tom Jones       4424      5/12/66     543354</div><div class="line">➜  ~ awk <span class="string">'$3&lt;3000'</span> employees</div><div class="line">Sally Chang     1654      7/22/54     650000</div><div class="line">Billy Black     1683      9/23/44     336500</div><div class="line">➜  ~ awk <span class="string">'$0 ~ /Tom/&#123;print&#125;'</span> employees</div><div class="line">Tom Jones       4424      5/12/66     543354</div><div class="line">➜  ~ awk <span class="string">'$0 ~ /Tom/&#123;print "NAMEINFO-&gt;" $1, "~"  ,$2&#125;'</span> employees</div><div class="line">NAMEINFO-&gt;Tom ~ Jones</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-3_模式匹配">2.3 模式匹配</h2><p>(a) 整行所有字段匹配<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'/[TM]/'</span> employees</div><div class="line">Tom Jones       4424      5/12/66     543354</div><div class="line">Mary Adams      5346      11/4/63     28765</div><div class="line">➜  ~ awk <span class="string">'/To|Mar/'</span> employees</div><div class="line">Tom Jones       4424      5/12/66     543354</div><div class="line">Mary Adams      5346      11/4/63     28765</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(b) ~ 特定字段匹配操作符，而使用符号!可以表示取反的意思<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'$2 ~ /Ch/ &#123;print NR,$1,$2&#125;'</span> employees  </div><div class="line">3 Sally Chang</div><div class="line">➜  ~ awk <span class="string">'$2 !~ /Ch/ &#123;print NR,$1,$2&#125;'</span> employees  </div><div class="line">1 Tom Jones</div><div class="line">2 Mary Adams</div><div class="line">4 Billy Black</div><div class="line">➜  ~ awk <span class="string">' $4 ~ /^Gr/'</span> datafile     </div><div class="line">western         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(c) 其他的匹配例子<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">' $5 ~ /\.[4-6]+/'</span> datafile</div><div class="line">eastern         EA      TB Savage               4.4     .84     5       20</div><div class="line">north           NO      Margot Weber            4.5     .89     5        9</div></pre></td></tr></table></figure></p>
<p>这个起到匹配作用的是4.4和4.5代表的字段哦，英文名字中有空格，占用了两个字段位</p>
<h2 id="2-4_关系运算符和条件表达式">2.4 关系运算符和条件表达式</h2><p>(a) &lt; &lt;= &gt; &gt;= != == ~ !~ 前面是一般的比较关系运算符，后面是用于字符串或者正则表达式是否匹配<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'$5 &gt;= 5.3'</span> datafile                       </div><div class="line">western         WE      Sharon Gray             5.3     .97     5       23</div><div class="line">northeast       NE      AM Main Jr.             5.1     .94     3       13</div><div class="line">central         CT      Ann Stephens            5.7     .94     5       13</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>上面我们看到一条有问题的数据，就是第二条记录。其实看看前面的姓名有三个字段…<br>(b) 算书运算 + - * / % ^<br>前面是正常的四则运算，而后面分别是除法、取余和取冪运算符。awk支持浮点运算，而且会按照浮点方式执行运算(比如下面的9/2=4.5)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'/centr/ &#123;print NR,$1,$2,$5+3,7+8&#125;'</span> datafile </div><div class="line">9 central CT 8.7 15</div><div class="line">➜  ~ <span class="built_in">echo</span> 9 | awk <span class="string">'&#123;print $1%2, $1/2&#125;'</span></div><div class="line">1 4.5</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(c) 逻辑运算 &amp;&amp; || !<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'$5 &gt; 5.5 &amp;&amp; $1 ~ /cen/'</span> datafile</div><div class="line">central         CT      Ann Stephens            5.7     .94     5       13</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(d) 条件表达式<br>类似于C/C++的?运算符，格式为：条件表达式1 ? 表达式2 : 表达式3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'NR&lt;3 &#123; print ( NF==8 ? "valid" : "invalid" ),"NF=",NF&#125;'</span> datafile</div><div class="line">valid NF= 8</div><div class="line">valid NF= 8</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(e) 范围模式 ,<br>awk的范围模式也是封闭范围。在所有记录中他们会顺序进行多次匹配，第一次匹配完后还可以进行下面接下来的第二次、第三次可能的匹配范围。如果开头匹配到了，但是没有结尾的话，会把整个文件记录的末尾当作是这次匹配的结尾作为范围<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'/north/,/south/ &#123;print NR, $1, $2&#125;'</span> datafile</div><div class="line">1 northwest NW</div><div class="line">2 western WE</div><div class="line">3 southwest SW</div><div class="line">7 northeast NE</div><div class="line">8 north NO</div><div class="line">9 central CT</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>上面例子的第二次匹配没有匹配到结尾，就默认到文件的结尾<br>(f) 赋值运算 = += -= *= /= %=<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'/north/ &#123;$1="NORTH" ; print NR,$1,$2,$3&#125;'</span> datafile</div><div class="line">1 NORTH NW Charles</div><div class="line">7 NORTH NE AM</div><div class="line">8 NORTH NO Margot</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-5_变量">2.5 变量</h2><p>(a) awk的内置变量<br>如上面例子中使用到的NR、NF，这些是awk内置的变量，可以使用$直接取值和设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ARGC          命令行参数个数</div><div class="line">ARGV          命令行参数构成胡数组</div><div class="line">FILENAME  当前输入文件的文件名</div><div class="line">FNR　         当前文件的记录数</div><div class="line">FS　            输入分割符，默认是空格字符</div><div class="line">NF               当前记录的字段数</div><div class="line">NR               当前的记录编号</div><div class="line">OFS             输出字段分割符</div><div class="line">ORS            记录分割符</div><div class="line">IGNORECASE  是否忽略大小写</div></pre></td></tr></table></figure></p>
<p>上面的FS、OFS看似都是空字符。其他使用例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  ~ <span class="built_in">echo</span> <span class="_">-ne</span> <span class="string">"123\n346\n"</span> | awk <span class="string">'&#123; print $0,ARGC,ARGV[0],FILENAME,FNR,FS,NF,NR,OFS &#125;'</span></div><div class="line">123 1 awk - 1   1 1 </div><div class="line">346 1 awk - 2   1 2 </div><div class="line">➜  ~ awk <span class="string">' &#123;IGNORECASE=1&#125;; $1=="North" &#123;print NR,$1,$2,$3&#125; '</span> datafile</div><div class="line">8 north NO Margot</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(b) 一般变量<br>变量类型: 数值类型(默认值0)，字符串类型(默认值””)<br>强制转化: name+0 name+””<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ <span class="built_in">echo</span> 123 | awk <span class="string">'&#123; x = $1; y = ++x; print "x="x,"y="y&#125;'</span></div><div class="line">x=124 y=124</div><div class="line">➜  ~ <span class="built_in">echo</span> 123 | awk <span class="string">'&#123; x = $1; y = x++; print "x="x,"y="y&#125;'</span></div><div class="line">x=124 y=123</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-6_BEGIN、END模式">2.6 BEGIN、END模式</h2><p>BEGIN是在对输入文件进行任何处理之前进行的操作块，而实际上不需要任何输入文件，也能执行BEGIN测试，所以后面有很多同输入无关的测试，这样就可以把这些代码写道BEGIN的语句块里面。使用过程中，通常在BEGIN中设置OFS、RS、FS等参数值，以及用户定义输入格式、变量定义初始化等操作。<br>END模式也不匹配任何输入，awk是在处理完毕所有输入行之后才处理END模式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">' BEGIN&#123;IGNORECASE=1; count=0&#125;; $1 ~ /North/ &#123;count++&#125; ; END&#123; print "Found",count&#125;  '</span> datafile</div><div class="line">Found 3</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-7_重定向和管道">2.7 重定向和管道</h2><p>(a) 支持 &gt; &gt;&gt;　重定向符号<br>使用的时候作为文件名参数需要使用””括起来，getline可以用于输入重定向来获得输入信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN &#123; "date" | getline date; print "The date is",date &gt; "date.file"&#125;'</span></div><div class="line">➜  ~ cat date.file</div><div class="line">The date is Wed Dec 28 18:43:39 HKT 2016</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(b) 管道 |<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'/north/ &#123; print $0 | "grep Charles" &#125;'</span> datafile</div><div class="line">northwest       NW      Charles Main            3.0     .98     3       34</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(c) system 函数。可以进行系统命令调用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN &#123; system("whoami") &#125;'</span></div><div class="line">v5kf</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(d) printf　格式化输出信息，跟C语言的类似<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN &#123; printf "Hello, %s, you are %d years old.\n","Nicol TAO","23"&#125;'</span></div><div class="line">Hello, Nicol TAO, you are 23 years old.</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-8_条件语句和循环">2.8 条件语句和循环</h2><p>(a) if<br>在条件模式中，if是隐含的模式了，而条件语句if也可以按照需要直接声明出来的<br>句式类似于if () {} else if () {} else {}<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'&#123; if( $1 ~ /north/) &#123; print "north related."&#125; else if ( $1 ~ /south/ ) &#123; print "south related."&#125; else &#123; print "wield..."&#125; &#125;'</span> datafile</div><div class="line">north related.</div><div class="line">wield...</div><div class="line">south related.</div><div class="line">south related.</div><div class="line">south related.</div><div class="line">wield...</div><div class="line">north related.</div><div class="line">north related.</div><div class="line">wield...</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(b) while<br>句法 while () {}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk &apos;BEGIN &#123; i = 0; count = 0; &#125; &#123; while ( i &lt; NR ) &#123; i ++; if ( $1 ~ /north/ ) &#123; count++; print NR,$1 $2 &#125; &#125; &#125; END &#123; print &quot;Count:&quot;,count &#125;&apos; datafile</div><div class="line">1 northwestNW</div><div class="line">7 northeastNE</div><div class="line">8 northNO</div><div class="line">Count: 3</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(c) for<br>普通for循环，句法for( ; ; ){}<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN &#123; i = 0;&#125; &#123; for(;i&lt;NR;i++) &#123; if( $1 ~ /north/ )&#123; print NR,$1,$2,"~~" &#125; &#125;&#125;'</span> datafile</div><div class="line">1 northwest NW ~~</div><div class="line">7 northeast NE ~~</div><div class="line">8 north NO ~~</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(d) break continue<br>同C/C++语言一样，是作用于跳出循环体和跳出本次循环的关键字。</p>
<h2 id="2-9_程序控制语句">2.9 程序控制语句</h2><p>(a) next<br>从文件中读取下一行输入，然后从awk脚本顶部开始重新执行。同continue效果也有点相似，只不过这里是作用于awk工具在对每行操作的自动“循环”中的<br>(b) exit<br>中断记录的处理，但是不能够跳过END语句块。exit可以带一个范围为0~255的退出参数，约定0表示成功，这个退出参数实际就传递给了$?表示执行的结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'&#123;  if ( $1 ~ /north/ ) &#123; print NR,$1,$2,"skip"; next; &#125; if ( $2 ~ /SO/ ) &#123; print NR,$1,$2,"exit will"; exit 3; &#125; print NR,$1,$2,"after if..."; &#125; END &#123; print "Fininal should be called here..." &#125;'</span> datafile</div><div class="line">1 northwest NW skip</div><div class="line">2 western WE after if...</div><div class="line">3 southwest SW after if...</div><div class="line">4 southern SO <span class="built_in">exit</span> will</div><div class="line">Fininal should be called here...</div><div class="line">➜  ~ <span class="built_in">echo</span> $?</div><div class="line">3</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-10_数组">2.10 数组</h2><p>(a) awk中的数组也可以称为键值对，因为数组的下标可以是字符串<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN&#123;x=0;i=0;&#125; &#123;name[x++]=$2;&#125; END &#123; for(;i&lt;NR;i++)&#123; print "name["i"] is",name[i]&#125; &#125;'</span> employees</div><div class="line">name[0] is Jones</div><div class="line">name[1] is Adams</div><div class="line">name[2] is Chang</div><div class="line">name[3] is Black</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(b) 上面是使用的普通for循环结构，而如果数组的下标不是数字类型时候，使用新的for遍历循环就很方便<br><code>for( item in array) { …array[item]…}</code><br>item会自动依次提取array中的索引值，实际数组元素可以通过array[item]来访问。awk中的数组是通过hash来存贮的，所以这里的便利理论上来说顺序是不确定的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'&#123;name[$1]=$2;&#125; END &#123; for(item in name ) &#123; print "Family name for",item,"is",name[item];&#125; &#125;'</span> employees</div><div class="line">Family name <span class="keyword">for</span> Tom is Jones</div><div class="line">Family name <span class="keyword">for</span> Sally is Chang</div><div class="line">Family name <span class="keyword">for</span> Mary is Adams</div><div class="line">Family name <span class="keyword">for</span> Billy is Black</div><div class="line">➜  ~ awk <span class="string">'&#123; if ($1 ~ /north/)&#123; count["north"] ++;&#125; else if ( $1 ~ /east/) count["east"]++; else count["other"]++;&#125; END&#123; for(item in count) &#123; print item,"related count:",count[item]; &#125; &#125;'</span> datafile</div><div class="line">other related count: 4</div><div class="line">east related count: 2</div><div class="line">north related count: 3</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>(c) 数组的其他部分<br>splite可以分割字符串，构造形成数组<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN&#123; str="/etc/samba/smb.conf"; split(str,name,"/"); for (item in name) print name[item]":";&#125;'</span></div><div class="line">:</div><div class="line">etc:</div><div class="line">samba:</div><div class="line">smb.conf:</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>这里的开头/被分割出来产生了一个空串哈…</p>
<h1 id="2-11_内置函数">2.11 内置函数</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sub               (/reg/,替换串[,目标串])</div><div class="line">gsub             (/reg/,替换串[,目标串])</div><div class="line">index(str,sub_str)　返回sub_str第一次在str中出现的位置(偏移量从1开始)</div><div class="line">length(str)     返回字符串的字符个数</div><div class="line">substr(str,start_pos[,length])　返回子串，如果没有length，就到串的末尾</div><div class="line">match(str,/reg/)     返回正则匹配在字符串中的位置，同时设置RSTART和RLENGTH的值</div><div class="line">split(str,arr_name[,split_sig])</div></pre></td></tr></table></figure>
<p>上面两个内置函数sub和gsub的区别是，sub只进行第一次替换，而gsub会对所有串进行替换(相当于s添加了g参数吧)。下面是操作例子<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'&#123;sub(/[Ee]ast/,"EAST",$1); print $1,index($1,"EAST"),"length",length($1);&#125;'</span> datafile</div><div class="line">northwest 0 length 9</div><div class="line">western 0 length 7</div><div class="line">southwest 0 length 9</div><div class="line">southern 0 length 8</div><div class="line">southEAST 6 length 9</div><div class="line">EASTern 1 length 7</div><div class="line">northEAST 6 length 9</div><div class="line">north 0 length 5</div><div class="line">central 0 length 7</div><div class="line">➜  ~ awk <span class="string">'&#123; sub(/lly/,"--&amp;**",$1); print $1 &#125;'</span> employees</div><div class="line">Tom</div><div class="line">Mary</div><div class="line">Sa--lly**</div><div class="line">Bi--lly**</div><div class="line">➜  ~ awk <span class="string">'&#123;if ( match($1,/[Ee]ast/) != 0) &#123; print RSTART,RLENGTH,$1; &#125;&#125;'</span> datafile</div><div class="line">6 4 southeast</div><div class="line">1 4 eastern</div><div class="line">6 4 northeast</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<p>上面可以看见&amp;的用法哈</p>
<h2 id="2-12_算数函数">2.12 算数函数</h2><p>atan2(x,y) cos(x) exp(x) log(x) sin(x) sqrt(x)<br>int(x)直接舍去小数，保留整数部分<br>rand() 产生随机数(0~1) srand(x) 初始化随机数种子<br>默认情况下每次调用rand()，结果都会产生相同的随机数，这时候需要调用srand()重新产生一个种子，后面的随机数才不同<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">➜  ~ awk <span class="string">'BEGIN&#123; print rand(),rand(),srand(),rand(),rand();&#125;'</span></div><div class="line">0.237788 0.291066 1 0.215969 0.629868</div><div class="line">➜  ~ awk <span class="string">'BEGIN&#123; print rand(),rand(),srand(),rand(),rand();&#125;'</span></div><div class="line">0.237788 0.291066 1 0.556348 0.749557</div><div class="line">➜  ~ awk <span class="string">'BEGIN&#123; print rand(),rand(),srand(),rand(),rand();&#125;'</span></div><div class="line">0.237788 0.291066 1 0.0931369 0.835396</div><div class="line">➜  ~</div></pre></td></tr></table></figure></p>
<h2 id="2-13_awk正则表达式元字符">2.13 awk正则表达式元字符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">^      行首定位符</div><div class="line">$      行尾定位符</div><div class="line">.      匹配除换行之外的单个字符</div><div class="line">*      匹配0个或者多个前导字符(这里是前导字符0或者多个，任意一个或多个字符，使用 .* )</div><div class="line">+      匹配一个或者多个前导字符</div><div class="line">?      匹配0个或者1个前导字符</div><div class="line">[]     指定字符中的任意一个字符，比如[Ll] [a-z]</div><div class="line">[^]    上面一样，不匹配的字符</div><div class="line">AA|BB  匹配AA或者BB</div><div class="line">(AB)+  匹配一个或者多个AB组合，比如AB,ABAB,ABABAB...</div><div class="line">\*     匹配*本身</div><div class="line">&amp;      保存查找匹配到的串，可以用在后面的替换中 s/love/**&amp;**/</div></pre></td></tr></table></figure>
<p>同第一部分sed工具相比，awk不支持的正则模式有<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">\(..\)   \&lt;        \&gt;    x\&#123;m\&#125;  x\&#123;m,\&#125;　x\&#123;m,n\&#125;</div></pre></td></tr></table></figure></p>
<p>从上面看来awk比较的复杂，已经具备了算数运算、逻辑、循环等一个脚本语言需要的大多数基本元素(貌似还缺函数)了。其实觉得单独用awk写脚本的不是很多，大多都是和sed一块，夹杂到shell<br>script里面用的。比如当时我工作时候用的例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">PRIMSAM=`cat /etc/hosts | /usr/xpg4/bin/grep <span class="string">"OAM_PRIMARY_IF_A"</span> | awk <span class="string">'&#123;print $2&#125;'</span>`</div><div class="line">SEDSAM=`cat /etc/hosts | /usr/xpg4/bin/grep <span class="string">"OAM_SECONDARY_IF_A"</span> | awk <span class="string">'&#123;print $2&#125;'</span>`</div><div class="line">count1=`ttsys -v 1 <span class="_">-e</span> <span class="string">"select count(*) from CONFIGPARAMS where NODENAME='CPSNodes' and SUBSYSTEMNAME='Call Processing' and MANAGERNAME='Call Manager' and PARAMNAME='LocNumMapFeature';quit"</span>|sed <span class="_">-e</span> <span class="string">'s/&lt; //g'</span> <span class="_">-e</span> <span class="string">'s/ &gt;//g'</span>|awk <span class="string">'&#123;print $1&#125;'</span>`</div></pre></td></tr></table></figure></p>
<p>还比如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SMBPRINC=`klist -k | grep <span class="string">"\&lt;root@"</span> | uniq | awk <span class="string">'&#123;print $2;&#125;'</span>`</div><div class="line">TMPDIR=<span class="string">"/"</span>`date +%N | md5sum | awk <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line">TMPFILE=`date +%N | md5sum | awk <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line">sed <span class="_">-e</span> <span class="string">"s/^MOUNTD_NFS_V2=.*$//g"</span> /etc/sysconfig/nfs -i 2&gt;&amp;1 &gt;/dev/null</div><div class="line">sed <span class="_">-e</span> &#123;s/REALM/$( <span class="built_in">echo</span> `hostname <span class="_">-d</span>` | tr [:lower:] [:upper:] )/&#125; <span class="variable">$TESTCONFIGFILE</span> -i</div></pre></td></tr></table></figure></p>
<p>看吧，当时做的笔记还是多认真的，那时的学习是多么单纯的一件事！<br>本文完！</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/201612/cmd-tools-sed-awk.html">文本处理利器sed与awk使用总结</a></p>
        <p><span>最后更新:</span>2016-12-30, 16:57:50</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/201612/cmd-tools-sed-awk.html" title="文本处理利器sed与awk使用总结">https://taozj.org/201612/cmd-tools-sed-awk.html</a>
            <span class="copy-path" data-clipboard-text="原文: https://taozj.org/201612/cmd-tools-sed-awk.html　　作者: taozj" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 请勿以任何形式转载文章完整正文
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/201701/linux-performance-basic.html">
                    Linux服务器的那些性能参数指标
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/201612/install-gentoo-root-zfs-on-macbookpro-2015-early.html">
                    MacbookPro上基于ZFS的Gentoo双系统安装
                </a>
            </div>
        
    </nav>


  
  
     <! -- 添加捐赠图标 -->

    

    <div class ="post-donate">
      <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="Donate 打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
           
            欣赏此文？赏份狗粮！
                     
        </span>
        <br>
      </div>  
  
      <div id="donate_guide" class="donate_bar center hidden">
        
          <a href="/post_images/resources/alipay.png" title="支付宝打赏" class="fancybox" rel="article0"       style="float:left;margin-left:25%;margin-right:2px;">
          <img src="/post_images/resources/alipay.png" title="支付宝打赏" height="164px" width="164px">
          </a> 
          

      
       <a href="/post_images/resources/weixin.png" title="微信打赏" class="fancybox" rel="article0">
         <img src="/post_images/resources/weixin.png" title="微信打赏" height="164px" width="164px">
       </a>
      
    
      </div>
  
      <script type="text/javascript">
        document.getElementById('btn_donate').onclick = function(){
          $('#donate_board').addClass('hidden');
          $('#donate_guide').removeClass('hidden');
        }
      </script>
    </div>

    

<! -- 添加捐赠图标 -->


  
</article>





    
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="201612/cmd-tools-sed-awk.html" data-title="文本处理利器sed与awk使用总结" data-url="https://taozj.org/201612/cmd-tools-sed-awk.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"freesign"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        <!-- ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//127.0.0.1:4000/js/embed.js'; -->
        ds.src = '/js/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/201701/linux-performance-basic.html" title="上一篇: Linux服务器的那些性能参数指标">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/201612/install-gentoo-root-zfs-on-macbookpro-2015-early.html" title="下一篇: MacbookPro上基于ZFS的Gentoo双系统安装">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/201702/study-note-of-scalable-backend-(5)-message-queue.html">后台开发那些常用技术再次小结（五）：消息队列</a></li><li class="post-list-item"><a class="post-list-link" href="/201702/study-note-of-scalable-backend-(4)-cache.html">后台开发那些常用技术再次小结（四）：缓存部分</a></li><li class="post-list-item"><a class="post-list-link" href="/201702/cmake-cheatsheet.html">CMake工具使用手册</a></li><li class="post-list-item"><a class="post-list-link" href="/201702/study-note-of-scalable-backend-(3)-storage.html">后台开发那些常用技术再次小结（三）：存储部分</a></li><li class="post-list-item"><a class="post-list-link" href="/201702/study-note-of-scalable-backend-(2)-web-service.html">后台开发那些常用技术再次小结（二）：Web服务层</a></li><li class="post-list-item"><a class="post-list-link" href="/201702/study-note-of-scalable-backend-(1)-front.html">后台开发那些常用技术再次小结（一）：前端部分</a></li><li class="post-list-item"><a class="post-list-link" href="/201702/little-thoughts-at-the-begin-of-2017.html">2017年春节返途中的两三思考</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/gnu-gdb-debug.html">GNU GDB调试手册</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/https-principle.html">HTTPS原理简单介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/rpc-principle-and-tips.html">RPC设计和使用中的一些杂谈</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/learn-note-of-distributed-system-(6)-application.html">分布式系统入门笔记（六）：基于ZooKeeper的分布式系统的应用场景</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/learn-note-of-distributed-system-(5)-zab-consensus.html">分布式系统入门笔记（五）：ZooKeeper之ZAB一致性协议</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/blog-collection.html">【置顶】博客资源收录大全</a></li><li class="post-list-item"><a class="post-list-link" href="/201701/linux-performance-basic.html">Linux服务器的那些性能参数指标</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/cmd-tools-sed-awk.html">文本处理利器sed与awk使用总结</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/install-gentoo-root-zfs-on-macbookpro-2015-early.html">MacbookPro上基于ZFS的Gentoo双系统安装</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/learn-note-of-distributed-system-(4)-raft-consensus.html">分布式系统入门笔记（四）：Raft一致性算法</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/read-note-of-amazon-dynamo.html">Amazon Dynamo论文阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/consistent-hashing.html">一致性hashing的原理解析</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/nginx-load-balancing.html">基于Nginx的软件负载均衡实现解读</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/study-conclusion-stage.html">【置顶】个人阶段性学习和规划总结(技能树)</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/design-patterns-(3)-behavioral.html">设计模式整理总结（三）：行为型模式</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/design-patterns-(2)-structural.html">设计模式整理总结（二）：结构型模式</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/http2-spec.html">HTTP/2协议规范和特性解读</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/learn-note-of-google-grpc.html">Google gRPC框架学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/201612/tcp-connection-keep-alive.html">网络开发中客户端连接保鲜机制的实现方法</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/design-patterns-(1)-creational.html">设计模式整理总结（一）：创建型模式</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/forkp-mulit-process-manage-framework.html">forkp多进程程序管理库的轮子</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/learn-note-of-distributed-system-(3)-see-paxos-from-phxpaxos.html">分布式系统入门笔记（三）：从PhxPaxos中再看Paxos协议工程实现</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/learn-note-of-tencent-libco-coroutine.html">腾讯libco协程库学习使用笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/libto-coroutine-library-base-on-boost-context2.html">基于Boost.Context2库的协程库轮子libto的设计与实现</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/learn-note-of-distributed-system-(2)-paxos-algorithm.html">分布式系统入门笔记（二）：Paxos算法介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/learn-note-of-distributed-system-(1)-abstraction-and-2PC-3PC.html">分布式系统入门笔记（一）：分布式系统基本概念和两三阶段提交</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/about-multi-process-thread-dev-manage.html">浅谈多进程程序的进程控制和管理方式</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/transform-work-env-to-mac-os.html">macOS新平台工作环境的设置和迁移</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/introduction-of-boost-context-and-new-coroutine-library.html">Boost.Context库简介及Boost.Coroutine协程使用方式</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/data-structure-and-algorithm-(4)-sort.html">数据结构和算法（四）：主流内排序算法</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/data-structure-and-algorithm-(3)-rbtree.html">数据结构和算法（三）：红黑二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/data-structure-and-algorithm-(2)-avl.html">数据结构和算法（二）：AVL自平衡二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/201611/data-structure-and-algorithm-(1)-hash.html">数据结构和算法（一）：hash散列容器</a></li><li class="post-list-item"><a class="post-list-link" href="/201610/talk-about-singleton.html">说说设计模式中的单例模式</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/basics-of-boost-asio-(3)-strand.html">Boost-Asio网络开发基础知识（三）：Strand序列化执行用户回调</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/basics-of-boost-asio-(2)-overview-of-the async-framework.html">Boost.Asio网络开发基础知识（二）：异步框架总览</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/basics-of-boost-asio-(1)-read-the-docs.html">Boost.Asio网络开发基础知识（一）：读读文档</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/cpp11-atomic-and-memory-model.html">C++11标准中的Atomic原子操作和内存模型</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/lockless-in-multi-thread.html">多线程开发中无锁队列的设计和实现</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/talk-about-io-seperation-design.html">开发中IO分离设计的重构杂谈</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/learn-note-of-protobuf.html">Google Protobuf数据交换格式的使用方法</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/read-(linux-mulit-thread-server-develop).html">《Linux多线程服务端编程》读摘</a></li><li class="post-list-item"><a class="post-list-link" href="/201609/usage-of-boost-coroutine.html">Boost.Coroutine协程库的简单使用</a></li><li class="post-list-item"><a class="post-list-link" href="/201608/feeling-of-cpp-11-and-two-ticks.html">C++11新标准阶段性学习心得及两个小轮子分享</a></li><li class="post-list-item"><a class="post-list-link" href="/201608/some-refined-and-modification-this-site.html">关于近来本站点的一些修改和设置</a></li><li class="post-list-item"><a class="post-list-link" href="/201607/learn-note-of-boost-(1)-smart-ptr-memory-pool.html">Boost库学习笔记(一)：智能指针和内存池</a></li><li class="post-list-item"><a class="post-list-link" href="/201607/simple-digit-recong-base-on-tesseract.html">基于Tesseract的数字识别程序</a></li><li class="post-list-item"><a class="post-list-link" href="/201607/construct-running-close-of-tcp.html">TCP链接的建立和关闭过程</a></li><li class="post-list-item"><a class="post-list-link" href="/201607/design-and-impl-of-minicached-base-on-memcached.html">基于memcached原理实现的单机轻量级通用缓存库</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/learn-note-of-libevent-(3)-internel-impl-and-framework.html">Libevent学习笔记（三）：内部实现原理初探</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/port-expose-based-on-libevent-(4)-dns-proxy-support.html">基于Libevent转发的内网端口暴露（四）：添加DNS代理的功能</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/read-(the-art-of-sober-thinking).html">读《清醒思考的艺术》感</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/personalized-reading-based-on-content-recommendation-(2)-svd-impl.html">基于内容推荐的个性化阅读实现（二）：基于SVD的推荐算法</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/port-expose-based-on-libevent-(3)-ss5-proxy-support.html">基于Libevent转发的内网端口暴露（三）：添加SS5代理功能</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/port-expose-based-on-libevent-(2)-refined-and-improvement.html">基于Libevent转发的内网端口暴露（二）：优化重构</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/port-expose-based-on-libevent-(1)-basic-impl.html">基于Libevent转发的内网端口暴露（一）：基本实现</a></li><li class="post-list-item"><a class="post-list-link" href="/201606/personalized-reading-based-on-content-recommendation-(1)-general-impl.html">基于内容推荐的个性化阅读实现（二）：基本实现</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/principle-of-oauth2.html">互联网OAuth 2.0开放授权原理</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/data-type-and-index-of-mysql-database.html">MySQL数据类型整理和索引介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/auto-answer-recommend-conclusion.html">答案自动推荐模块项目小结</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/learn-note-of-libevent-(2)-thread-pool-in-memcached.html">Libevent学习笔记（二）：Memcached中Libevent和线程池使用初探</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/fastcgi-support-for-http-server-libmicrohttpd.html">对libmicrohttpd添加FastCGI协议支持</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/learn-note-of-libevent-(1)-basic-usage.html">Libevent学习笔记（一）：基本使用</a></li><li class="post-list-item"><a class="post-list-link" href="/201605/usage-of-apache-lucy-fulltext-index.html">Apache Lucy的全文检索引擎的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/fulltext-search-based-on-lsi-lda.html">基于LSI/LDA的文本检索的原理和操作步骤</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/linux-env-program-(2)-difference-select-poll-epoll.html">Linux环境开发（二）：IO复用之select/poll/epoll之原理和差异分析</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/linux-env-program-(1)-async-blocking-io-model.html">Linux环境开发（一）：同异步、阻塞的IO模型相关问题</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/oversee-of-http-based-on-libmicrohttpd.html">基于libmicrohttpd的HTTP服务器初探</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/server-prog-port-from-windows-to-linux.html">Windows服务端程序向Linux移植经验总结</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/recommend-system-algorithm.html">推荐系统常用的推荐算法</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/recommend-system-cases.html">推荐系统的典型推荐案例</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/how-to-calc-svd.html">SVD的数学计算步骤</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/conclusion-of-machine-learning-algorithm.html">不带公式的机器学习算法整理</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/random-sampling-method.html">随机采样方法</a></li><li class="post-list-item"><a class="post-list-link" href="/201604/statistics-frequency-bayesian.html">统计学之边角料——频率派和贝叶斯派</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/learn-note-of-spark-(3)-relative-modules.html">Spark学习手册（三）：Spark模块学习摘读</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/learn-note-of-spark-(2)-read-official-doc.html">Spark学习手册（二）：Spark官方手册读摘</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/learn-note-of-spark-(1)-construct-spark-hdfs.html">Spark学习手册（一）：HDFS支撑的Spark环境搭建与尝试</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/learn-note-of-pro-git.html">Pro Git速查笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/interesting-cases-of-machine-learning.html">深度学习的那些有趣案例</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/how-to-love-dog.html">我的养狗笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/one-year-old-of-my-zaizai.html">我们仔仔快要一岁啦</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/how-to-survive-from-info-ocean.html">面对越来越多的信息我们是怎么了</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/encrypt-safe-your-file-and-email-gpg.html">请善用GPG安全你的邮件和文件</a></li><li class="post-list-item"><a class="post-list-link" href="/201603/blog-site-under-https.html">我的博客用上HTTPS啦</a></li><li class="post-list-item"><a class="post-list-link" href="/201602/learn-note-of-numpy.html">NumPy科学计算库学习记录</a></li><li class="post-list-item"><a class="post-list-link" href="/201602/leave-tp-link-at-2015.html">2015年工作总结——离开TP之路</a></li><li class="post-list-item"><a class="post-list-link" href="/201602/read-(i-am-in-taobao-these-ten-years).html">读《淘宝技术这十年》感</a></li><li class="post-list-item"><a class="post-list-link" href="/201602/usage-and-optimize-of-zfs.html">终极文件系统ZFS的使用与优化技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/201602/setup-dev-env-for-pebble-smartphone.html">Pebble嵌入式开发环境搭建和开发测试样例</a></li><li class="post-list-item"><a class="post-list-link" href="/201601/read-(the-mystery-of-silicon-valley).html">读《硅谷之谜》感</a></li><li class="post-list-item"><a class="post-list-link" href="/201601/conclusion-of-machine-learning.html">机器学习中自然语言处理之总结</a></li><li class="post-list-item"><a class="post-list-link" href="/201601/gentoo-overlay-and-software-recommend.html">我的Gentoo Overlay和Linux软件推荐</a></li><li class="post-list-item"><a class="post-list-link" href="/201510/docker-examples.html">Docker容器技术使用实例</a></li><li class="post-list-item"><a class="post-list-link" href="/201510/mail-server-based-on-postfix-dovecot.html">搭建基于Postfix和Dovecot的邮件服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/201509/rpmbuild-package-example-(2).html">RedHat系列软件打包实例（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/201509/rpmbuild-package-example-(1).html">RedHat系列RPM软件打包实例（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/201509/generate-makefile-through-autotools.html">利用autotools自动生成项目的Makefile</a></li><li class="post-list-item"><a class="post-list-link" href="/201508/keepass-pass-save.html">开源的个人密码管理器软件KeePass</a></li><li class="post-list-item"><a class="post-list-link" href="/201508/learning-and-debug-linux-kernel-under-windows.html">在Windows下通过虚拟机搭建Linux内核的学习和调试环境</a></li></ul>




    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2017 taozj
            </div>
            <div class="footer-right">
                <a href="http://www.miitbeian.gov.cn/" target="_blank" rel="nofollow">
                    <img src="/post_images/icons/icp_min.png" alt="粤ICP备17002382号-1">粤ICP备17002382号-1
                </a>
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258402767'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/stat.php%3Fid%3D1258402767%26online%3D2' type='text/javascript'%3E%3C/script%3E"));
                </script>
                Powered by <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>, theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题">Yelee</a>  enhanced by Nicol <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
    </div>
</footer>

    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.1.22/require.min.js"></script>
<script src="/js/search.js"></script> 


    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 10;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>




    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

    <script src="//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js"></script>


   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</script>

  </div>
</body>
</html>